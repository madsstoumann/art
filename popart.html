<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>random.art: triangles</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<link href="art.css" rel="stylesheet" />

</head>
<body>
	<input type="checkbox" id="toggle" class="sr" />
	<label for="toggle" class="toggle-label" aria-label="Toggle Controls">
		<svg width="44" height="44" viewBox="0 0 24 24" stroke-width="1" stroke="hsl(200, 15%, 95%)" fill="none" stroke-linecap="round" stroke-linejoin="round">
			<path stroke="none" d="M0 0h24v24H0z" fill="hsl(200, 15%, 15%)"/>
			<circle cx="14" cy="6" r="2" />
			<line x1="4" y1="6" x2="12" y2="6" />
			<line x1="16" y1="6" x2="20" y2="6" />
			<circle cx="8" cy="12" r="2" />
			<line x1="4" y1="12" x2="6" y2="12" />
			<line x1="10" y1="12" x2="20" y2="12" />
			<circle cx="17" cy="18" r="2" />
			<line x1="4" y1="18" x2="15" y2="18" />
			<line x1="19" y1="18" x2="20" y2="18" />
		</svg>
		<svg width="44" height="44" viewBox="0 0 24 24" stroke-width="1" stroke="hsl(200, 15%, 95%)" fill="none" stroke-linecap="round" stroke-linejoin="round">
			<path stroke="none" d="M0 0h24v24H0z" fill="hsl(200, 15%, 15%)"/>
			<line x1="18" y1="6" x2="6" y2="18" />
			<line x1="6" y1="6" x2="18" y2="18" />
		</svg>
	</label>

	<svg class="bg" id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1000 1000" style="background-color:hsl(360, 50%, 100%)">
		<defs>
			<pattern id="C" patternUnits="userSpaceOnUse" width="32" height="32"><circle fill="cyan" cx="16" cy="16" r="8"></circle></pattern>
			<pattern id="M" patternUnits="userSpaceOnUse" width="32" height="32"><circle fill="magenta" cx="16" cy="16" r="8"></circle></pattern>
			<pattern id="Y" patternUnits="userSpaceOnUse" width="32" height="32"><circle fill="yellow" cx="16" cy="16" r="8"></circle></pattern>
			<pattern id="K" patternUnits="userSpaceOnUse" width="32" height="32"><circle fill="black" cx="16" cy="16" r="8"></circle></pattern>
		</defs>
		<g id="g"></g>
	</svg>

	<main>
		<form class="panel" id="app">
			<details class="group" open>
				<summary class="group-header">canvas & shape</summary>
				<div class="group-panel">
					<label class="rl" data-value="8">
						cyan
						<input type="range" class="range" id="cyan" min="1" max="16" value="8" />
					</label>
					<label class="rl" data-value="8">
						magenta
						<input type="range" class="range" id="magenta" min="1" max="16" value="8" />
					</label>
					<label class="rl" data-value="8">
						yellow
						<input type="range" class="range" id="yellow" min="1" max="16" value="8" />
					</label>
					<label class="rl" data-value="8">
						black
						<input type="range" class="range" id="black" min="1" max="16" value="8" />
					</label>
					
					
					<label class="rl" data-value="100">
						canvas y:x ratio
						<input type="range" class="range" id="ratio" min="25" max="150" value="100" />
					</label>
					<label class="gl glc">
						<input type="checkbox" class="sr" id="scalecanvas" checked />
						<span>scale to canvas / 1:1</span>
					</label>
					<label class="rl" data-value="0">
						rotate
						<input type="range" class="range" min="0" max="360" value="0" id="rotate" data-attr="1" />
					</label>
					<label class="rl" data-value="1">
						scale-x
						<input type="range" class="range" min="0.01" max="3" step="0.01" value="1" id="scaleX" data-attr="1" />
					</label>
					<label class="rl" data-value="1">
						scale-y
						<input type="range" class="range" min="0.01" max="3" step="0.01" value="1" id="scaleY" data-attr="1" />
					</label>
					<label class="rl" data-value="0">
						translate-x
						<input type="range" class="range" min="-1000" max="1000" value="0" id="translateX" data-attr="1" />
					</label>
					<label class="rl" data-value="0">
						translate-y
						<input type="range" class="range" min="-1000" max="1000" value="0" id="translateY" data-attr="1" />
					</label>
					<label class="gl glc">
						<input type="checkbox" class="sr" id="showcircles" />
						<span>show circles</span>
					</label>
				</div>
			</details>

			<details class="group">
				<summary class="group-header">background</summary>
				<div class="group-panel">
					<label class="rl" data-value="360">
						hue
						<input type="range" class="range range--hue" id="huebg" name="--hue-bg" min="0" max="360" value="360" data-attr="1" />
					</label>
					<label class="rl" data-value="50">
						saturation
						<input type="range" class="range" id="satbg" name="--sat-bg" min="0" max="100" value="50" data-suffix="%" data-attr="1" />
					</label>
					<label class="rl" data-value="50">
						lightness
						<input type="range" class="range" id="lightbg" name="--light-bg" min="0" max="100" value="50" data-suffix="%" data-attr="1" />
					</label>
				</div>
			</details>

			<details class="group">
				<summary class="group-header">export</summary>
				<div class="group-panel">
					<fieldset class="gf">
						<legend>file format</legend>
						<label class="gl">
							<input type="radio" class="sr" name="file" value="svg" data-ignore="1">
							<span>svg</span>
						</label>
						<label class="gl">
							<input type="radio" class="sr" name="file" value="" data-ignore="1" checked>
							<span>png</span>
						</label>
						<label class="gl">
							<input type="radio" class="sr" name="file" value="jpg" data-ignore="1">
							<span>jpg</span>
						</label>
						<label class="gl">
							<input type="radio" class="sr" name="file" value="webp" data-ignore="1">
							<span>webp</span>
						</label>
					</fieldset>
					<button type="button" class="gb" onclick="saveSVG(svg,app.elements.file.value)">Save To Image</button>
				</div>
			</details>
		</form>
	</main>

<script>

function render(input) {
	if (input?.dataset.ignore) return;
  if (input?.type === 'range') {
		input.parentNode.dataset.value = input.value;
		if (input.name) document.body.style.setProperty(input.name, `${input.valueAsNumber}${input.dataset.suffix||''}`)
	}
	if (input?.dataset.attr) {
		svg.setAttribute('style', `background-color: hsl(${huebg.valueAsNumber}, ${satbg.valueAsNumber}%, ${lightbg.valueAsNumber}%)`);
		g.setAttribute('transform', `rotate(${rotate.valueAsNumber}, 500, ${ratio.valueAsNumber * 5}) scale(${scaleX.valueAsNumber}, ${scaleY.valueAsNumber}) translate(${translateX.valueAsNumber}, ${translateY.valueAsNumber})`);
		return;
	}

	if (input?.id === 'cyan') {
		C.innerHTML = `<circle fill="cyan" cx="16" cy="16" r="${input.valueAsNumber}"></circle>`
	}
	if (input?.id === 'magenta') {
		M.innerHTML = `<circle fill="magenta" cx="16" cy="16" r="${input.valueAsNumber}"></circle>`
	}
	if (input?.id === 'yellow') {
		Y.innerHTML = `<circle fill="yellow" cx="16" cy="16" r="${input.valueAsNumber}"></circle>`
	}
	if (input?.id === 'black') {
		K.innerHTML = `<circle fill="black" cx="16" cy="16" r="${input.valueAsNumber}"></circle>`
	}

	svg.setAttribute('viewBox', `0 0 1000 ${ratio.valueAsNumber * 10}`);


	// const triangles = Delaunay.triangulate(vertices);
	const fill = 'url(#circles)'; //`hsl(${huebg.valueAsNumber}, ${satbg.valueAsNumber}%, 55%)`;
	const stroke = `hsl(${huebg.valueAsNumber}, ${satbg.valueAsNumber}%, 15%)`;
	g.innerHTML = `
		<rect x="0" y="0" width="1000" height="${ratio.valueAsNumber * 10}" fill="url(#C)" transform="rotate(45)" />
		<rect x="0" y="0" width="1000" height="${ratio.valueAsNumber * 10}" fill="url(#M)" transform="rotate(15)" />
		<rect x="0" y="0" width="1000" height="${ratio.valueAsNumber * 10}" fill="url(#Y)" />
		
		`;
}
function R(max, min = 0, f = true) {
  return f ? Math.floor(Math.random() * (max - min) + min) : Math.random() * max;
};

function toggle(event) {
	summary.forEach(node => {
		if (node !== event.target) node.parentNode.open = false;
	});
}

function saveSVG(svg, ext = 'png') {
  const D = (href, name) => {
    const L = document.createElement('a');
    L.download = name;
    L.style.opacity = "0";
    document.body.append(L);
    L.href = href;
    L.click();
    L.remove()
  }

  const {width, height} = svg.getBBox(); 
	let clone = svg.outerHTML;
  const blob = new Blob([clone],{type:'image/svg+xml;charset=utf-8'});
  const format = { png: '', jpg: 'image/jpg', webp: 'image/webp' };
  if (ext === 'svg') {
		D(URL.createObjectURL(blob), 'image.svg');
		return;
	}

	const img = new Image();

  img.onload = () => {
    const C = document.createElement('canvas');
    C.width = width;
    C.height = height;
    const X = C.getContext('2d');
    X.drawImage(img, 0, 0, width, height);
    D(C.toDataURL(format[ext], 1), `image.${ext}`)
  };
  img.src = URL.createObjectURL(blob);
}

/* --- */

const summary = app.querySelectorAll('summary');
summary.forEach(node => node.addEventListener('click', toggle));

app.addEventListener('input', (event) => { if (event.target) render(event.target); });
render();
</script>
</body>
</html>